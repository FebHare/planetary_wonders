namespace = pw_wonder

# Initial event to say this mod is active.
event = {
	id = pw_wonder.0
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { set_global_flag = pw_active }
}

#Message for wonder construction complete
# UNUSED!
planet_event = {
	id = pw_wonder.1
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_space_elevator_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = WONDER
				scope = FROM
			}
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}
	}
}

# Space Elevator -> id 100

#On Space Elevator built
planet_event = {
	id = pw_wonder.100
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_space_elevator_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.101 }
		planet_event = { id = pw_wonder.102 }
		planet_event = { id = pw_wonder.103 days = 5 }
	}
}

#On first time Space Elevator is built (regular empire)
planet_event = {
	id = pw_wonder.101
	title = pw_wonder.101.name
	desc = pw_wonder.101.desc
	picture = GFX_evt_space_elevator
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = {owner = {has_country_flag = space_elevator_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = space_elevator_built }
	}

	option = {
		name = pw_wonder.101.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		add_modifier = {
			modifier = pw_mod_space_elevator_xenophile
			days = @pw_5years
		}
	}

	option = {
		name = pw_wonder.101.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		add_modifier = {
			modifier = pw_mod_space_elevator_xenophobe
			days = @pw_5years
		}
	}
}

#On first time Space Elevator is built (gestalt)
planet_event = {
	id = pw_wonder.102
	title = pw_wonder.102.name
	desc = pw_wonder.102.desc
	picture = GFX_evt_space_elevator
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.102.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.102.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = {has_country_flag = space_elevator_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = space_elevator_built }
	}
}

#Random choice of event after Space Elevator is build.
planet_event = {
	id = pw_wonder.103
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_building = pw_building_space_elevator
	}

	immediate = {
		if = {
			limit = { owner = { is_gestalt = no }}
			random_list = {
				10 = {
					planet_event = { id = pw_wonder.104 days = 180 random = 180 }
				}
				10 = {
					planet_event = { id = pw_wonder.105 days = 180 random = 180 }
				}
				10 = {
					planet_event = { id = pw_wonder.106 days = 180 random = 180 }
				}
			}
		}
	}
}

#Seize unregulated goods
planet_event = {
	id = pw_wonder.104
	title = pw_wonder.104.name
	desc = pw_wonder.104.desc
	picture = GFX_evt_space_elevator
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		owner = { has_country_flag = pw_wonder_event_104 }
		has_building = pw_building_space_elevator
	}
	immediate = {
		owner = { set_country_flag = pw_wonder_event_104 }
	}
	option = {
		name = pw_wonder.104.a
		owner = {
			add_resource = {
				consumer_goods = 1000
			}
		}
	}
	option = {
		name = pw_wonder.104.b
		owner = {
			add_resource = {
				energy = 2500
			}
		}
	}
}

#Banned Substances
planet_event = {
	id = pw_wonder.105
	title = pw_wonder.105.name
	desc = pw_wonder.105.desc
	picture = GFX_evt_space_elevator
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		owner = { has_country_flag = pw_wonder_event_105 }
		has_building = pw_building_space_elevator
	}
	immediate = {
		owner = { set_country_flag = pw_wonder_event_105 }
	}
	option = {
		name = pw_wonder.105.a
		add_modifier = { modifier = pw_mod_space_elevator_105_a days = @pw_5years }
	}
	option = {
		name = pw_wonder.105.b
		add_modifier = { modifier = pw_mod_space_elevator_105_b days = @pw_5years }
	}
	option = {
		name = pw_wonder.105.c
		add_modifier = { modifier = pw_mod_space_elevator_105_c days = @pw_5years }
	}
}

#Stowaways
planet_event = {
	id = pw_wonder.106
	title = pw_wonder.106.name
	desc = pw_wonder.106.desc
	picture = GFX_evt_space_elevator
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		owner = { has_country_flag = pw_wonder_event_106 }
		has_building = pw_building_space_elevator
	}
	immediate = {
		owner = { set_country_flag = pw_wonder_event_106 }
	}
	option = {
		name = pw_wonder.106.a
		create_pop = {
			species = owner
		}
	}
	option = {
		name = pw_wonder.106.b
		create_fleet = {
			name = "Stowaways"
			effect = {
				set_owner = owner
				set_location = THIS
				create_ship = {
					name = "Stowaways"
					design = shipclass_colonizer
				}
			}
		}
	}
	option = {
		name = pw_wonder.106.c
		owner = {
			add_resource = {
				influence = 100
			}
		}
	}
}


# Particle Supercollider -> id 200

#On Particle Supercollider built
planet_event = {
	id = pw_wonder.200
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_particle_supercollider_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.201 }
		planet_event = { id = pw_wonder.202 }
	}
}

#On first time Particle Supercollider is built (Regular Empire)
planet_event = {
	id = pw_wonder.201
	title = pw_wonder.201.name
	desc = pw_wonder.201.desc
	picture = GFX_evt_ancient_databank
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.201.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		# trigger = {
			# owner = { is_spiritualist = no }
		# }
	}

	option = {
		name = pw_wonder.201.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		# trigger = {
			# owner = { is_materialist = no }
		# }
	}

	trigger = {
		NOT = {owner = {has_country_flag = particle_supercollider_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = particle_supercollider_built }
	}
}

#On first time Particle Supercollider is built (Gestalt)
planet_event = {
	id = pw_wonder.202
	title = pw_wonder.202.name
	desc = pw_wonder.202.desc
	picture = GFX_evt_ancient_databank
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.202.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.202.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = {has_country_flag = particle_supercollider_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = particle_supercollider_built }
	}
}

# Domed City -> id 300

#On Domed City built
planet_event = {
	id = pw_wonder.300
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		if = {
			limit = { is_planet_class = pc_habitat }
			create_message = {
				type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
				localization = pw_message_secluded_sector_complete
				days = 30
				target = THIS
				variable = {
					type = name
					localization = PLANET
					scope = ROOT
				}
			}
		}
		else = {
			create_message = {
				type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
				localization = pw_message_domed_city_complete
				days = 30
				target = THIS
				variable = {
					type = name
					localization = PLANET
					scope = ROOT
				}
			}
		}

		planet_event = { id = pw_wonder.301 }
		planet_event = { id = pw_wonder.302 }
	}
}

#On first time Domed City is built (Regular Empire)
planet_event = {
	id = pw_wonder.301
	title = pw_wonder.301.name
	desc = {
		trigger = {
			NOT = { is_planet_class = pc_habitat }
		}
		text = pw_wonder.301.desc.planet
	}
	desc = {
		trigger = {
			is_planet_class = pc_habitat
		}
		text = pw_wonder.301.desc.habitat
	}

	picture = GFX_evt_domed_city
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.301.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		# trigger = {
			# owner = { is_authoritarian = no }
		# }
	}

	option = {
		name = pw_wonder.301.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		# trigger = {
			# owner = { is_egalitarian = no }
		# }
	}

	trigger = {
		NOT = {owner = {has_country_flag = domed_city_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = domed_city_built }
	}
}

#On first time Domed City is built (Gestalt)
planet_event = {
	id = pw_wonder.302
	title = pw_wonder.302.name
	desc = {
		trigger = {
			NOT = { is_planet_class = pc_habitat }
		}
		text = pw_wonder.302.desc.planet
	}
	desc = {
		trigger = {
			is_planet_class = pc_habitat
		}
		text = pw_wonder.302.desc.habitat
	}
	picture = GFX_evt_domed_city
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.302.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.302.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = {has_country_flag = domed_city_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = domed_city_built }
	}
}

# Abyssal Crater Test Site -> id 400

#On Abyssal Crater Test Site built
planet_event = {
	id = pw_wonder.400
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		if = {
			limit = { is_planet_class = pc_habitat }
			create_message = {
				type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
				localization = pw_message_abyssal_crater_test_site_habitat_complete
				days = 30
				target = THIS
				variable = {
					type = name
					localization = PLANET
					scope = ROOT
				}
			}
		}
		else = {
			create_message = {
				type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
				localization = pw_message_abyssal_crater_test_site_complete
				days = 30
				target = THIS
				variable = {
					type = name
					localization = PLANET
					scope = ROOT
				}
			}
		}

		planet_event = { id = pw_wonder.401 }
		planet_event = { id = pw_wonder.402 }
	}
}

#On first time Abyssal Crater Test Site is built (regular Empire)
planet_event = {
	id = pw_wonder.401
	title = pw_wonder.401.name
	desc = {
		trigger = {
			NOT = { is_planet_class = pc_habitat }
		}
		text = pw_wonder.401.desc.planet
	}
	desc = {
		trigger = {
			is_planet_class = pc_habitat
		}
		text = pw_wonder.401.desc.habitat
	}
	picture = GFX_evt_abyssal_crater_test_site
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.401.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		# trigger = {
			# owner = { is_militarist = no }
		# }
	}

	option = {
		name = pw_wonder.401.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		# trigger = {
			# owner = { is_pacifist = no }
		# }
	}

	trigger = {
		NOT = {owner = { has_country_flag = abyssal_crater_test_site_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = abyssal_crater_test_site_built }
	}
}

#On first time Abyssal Crater Test Site is built (Gestalt)
planet_event = {
	id = pw_wonder.402
	title = pw_wonder.402.name
	desc = {
		trigger = {
			NOT = { is_planet_class = pc_habitat }
		}
		text = pw_wonder.402.desc.planet
	}
	desc = {
		trigger = {
			is_planet_class = pc_habitat
		}
		text = pw_wonder.402.desc.habitat
	}
	picture = GFX_evt_abyssal_crater_test_site
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.402.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.402.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = abyssal_crater_test_site_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = abyssal_crater_test_site_built }
	}
}

# Erebus Project -> id 500

#On Erebus Project built
planet_event = {
	id = pw_wonder.500
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_erebus_project_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.501 }
		planet_event = { id = pw_wonder.502 }
	}
}

#On first time Erebus Project is built (Regular Empire)
planet_event = {
	id = pw_wonder.501
	title = pw_wonder.501.name
	desc = pw_wonder.501.desc
	picture = GFX_evt_mining_operations
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.501.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = erebus_project_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = erebus_project_built }
	}
}

#On first time Erebus Project is built (Gestalt)
planet_event = {
	id = pw_wonder.502
	title = pw_wonder.502.name
	desc = pw_wonder.502.desc
	picture = GFX_evt_mining_operations
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.502.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = erebus_project_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = erebus_project_built }
	}
}

#Random Aggressive Prospecting effect
planet_event = {
	id = pw_wonder.503
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = { has_planet_flag = pw_aggressive_prospecting_event_triggered }
		has_modifier = pw_mod_erebus_prospecting
	}

	immediate = {
		if = {
			limit = { #Exhausted mining options.
				has_planet_flag = pw_aggressive_prospecting_crystal
				has_planet_flag = pw_aggressive_prospecting_motes
				has_planet_flag = pw_aggressive_prospecting_gases
			}
			planet_event = {
				id = pw_wonder.510
				days = 60
				random = 30
			}
		}
		else = {
			random_list = {
				10 = {
					planet_event = {
						id = pw_wonder.504
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.506
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.508
						days = 60
						random = 30
					}
				}
				10 = {}
			}
		}
	}
}

#Check if already added crystals
planet_event = {
	id = pw_wonder.504
	hide_window = yes
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_erebus_project
	}
	immediate = {
		if = {
			limit = { has_planet_flag = pw_aggressive_prospecting_crystal }
			planet_event = { id = pw_wonder.503 }
		}
		else = {
			planet_event = { id = pw_wonder.505 }
		}
	}
}

#Aggressive Prospecting adds Crystals
planet_event = {
	id = pw_wonder.505
	title = pw_wonder.505.name
	desc = pw_wonder.505.desc
	picture = GFX_evt_mining_operations
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	immediate = {
		set_planet_flag = pw_aggressive_prospecting_crystal
	}
	trigger = {
		has_building = pw_building_erebus_project
	}
	option = {
		name = pw_wonder.505.a
		owner = {
			add_resource = {
				rare_crystals = 500
			}
		}
	}
}

#Check if already added motes
planet_event = {
	id = pw_wonder.506
	hide_window = yes
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_erebus_project
	}
	immediate = {
		if = {
			limit = { has_planet_flag = pw_aggressive_prospecting_motes }
			planet_event = { id = pw_wonder.503 }
		}
		else = {
			planet_event = { id = pw_wonder.507 }
		}
	}
}

#Aggressive Prospecting adds Motes
planet_event = {
	id = pw_wonder.507
	title = pw_wonder.507.name
	desc = pw_wonder.507.desc
	picture = GFX_evt_mining_operations
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	immediate = {
		set_planet_flag = pw_aggressive_prospecting_motes
	}
	trigger = {
		has_building = pw_building_erebus_project
	}
	option = {
		name = pw_wonder.507.a
		owner = {
			add_resource = {
				volatile_motes = 500
			}
		}
	}
}

#Check if already added gases
planet_event = {
	id = pw_wonder.508
	hide_window = yes
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_erebus_project
	}
	immediate = {
		if = {
			limit = { has_planet_flag = pw_aggressive_prospecting_gases }
			planet_event = { id = pw_wonder.503 }
		}
		else = {
			planet_event = { id = pw_wonder.509 }
		}
	}
}

#Aggressive Prospecting adds gases
planet_event = {
	id = pw_wonder.509
	title = pw_wonder.509.name
	desc = pw_wonder.509.desc
	picture = GFX_evt_mining_operations
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	immediate = {
		set_planet_flag = pw_aggressive_prospecting_gases
	}
	trigger = {
		has_building = pw_building_erebus_project
	}
	option = {
		name = pw_wonder.509.a
		owner = {
			add_resource = {
				exotic_gases = 500
			}
		}
	}
}

#Aggressive Prospecting adds Poor Mineral Quality
planet_event = {
	id = pw_wonder.510
	title = pw_wonder.510.name
	desc = pw_wonder.510.desc
	picture = GFX_evt_mining_operations
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_helios_tower
	}
	immediate = {
		set_planet_flag = pw_aggressive_prospecting_event_triggered
	}
	option = {
		name = pw_wonder.510.a
		if = {
			limit = { NOT = { has_planet_modifier = pm_mineral_poor }}
			add_modifier = {
				modifier = mineral_poor
			}
		}
	}
}

# Helios Tower -> id 600

#On Helios Tower built
planet_event = {
	id = pw_wonder.600
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_helios_tower_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.601 }
		planet_event = { id = pw_wonder.602 }
	}
}

#On first time Helios Tower is built (Regular Empire)
planet_event = {
	id = pw_wonder.601
	title = pw_wonder.601.name
	desc = pw_wonder.601.desc
	picture = GFX_evt_helios_tower
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.601.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = helios_tower_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = helios_tower_built }
	}
}

#On first time Helios Tower is built (Gestalt)
planet_event = {
	id = pw_wonder.602
	title = pw_wonder.602.name
	desc = pw_wonder.602.desc
	picture = GFX_evt_helios_tower
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.602.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = helios_tower_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = helios_tower_built }
	}
}

#Random Cloud Seeding effect
planet_event = {
	id = pw_wonder.603
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = { has_planet_flag = pw_cloud_seeding_event_triggered }
	}

	immediate = {
		set_planet_flag = pw_cloud_seeding_event_triggered
		if = {
			limit = { #Machine and Hive planets can't have Atmospheric Aphrodisiacs mod.
				OR = {
					is_planet_class = pc_machine
					is_planet_class = pc_hive
				}
			}
			random_list = {
				10 = {
					planet_event = {
						id = pw_wonder.604
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.605
						days = 60
						random = 30
					}
				}
				5 = {}
			}
		}
		else = {
			random_list = {
				10 = {
					planet_event = {
						id = pw_wonder.604
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.605
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.606
						days = 60
						random = 30
					}
				}
				5 = {}
			}
		}
	}
}

#Cloud Seeding adds Hazardous Weather
planet_event = {
	id = pw_wonder.604
	title = pw_wonder.604.name
	desc = pw_wonder.604.desc
	picture = GFX_evt_helios_tower
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_hazardous_weather }
		has_building = pw_building_helios_tower
	}
	option = {
		name = pw_wonder.604.a
		add_modifier = {
			modifier = hazardous_weather
		}
	}
	option = {
		name = pw_wonder.604.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 1000
				}
			}
		}
		owner = {
			add_resource = {
				energy = -1000
			}
		}
	}
}

#Cloud Seeding adds Wild Storms
planet_event = {
	id = pw_wonder.605
	title = pw_wonder.605.name
	desc = pw_wonder.605.desc
	picture = GFX_evt_helios_tower
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_wild_storms }
		has_building = pw_building_helios_tower
	}
	option = {
		name = pw_wonder.605.a
		add_modifier = {
			modifier = wild_storms
		}
	}
	option = {
		name = pw_wonder.605.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 1000
				}
			}
		}
		owner = {
			add_resource = {
				energy = -1000
			}
		}
	}
}

#Cloud Seeding adds Atmospheric Aphrodisiacs
planet_event = {
	id = pw_wonder.606
	title = pw_wonder.606.name
	desc = pw_wonder.606.desc
	picture = GFX_evt_helios_tower
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_atmospheric_aphrodisiac }
		has_building = pw_building_helios_tower
	}
	option = {
		name = pw_wonder.606.a
		add_modifier = {
			modifier = atmospheric_aphrodisiac
		}
	}
	option = {
		name = pw_wonder.606.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 1000
				}
			}
		}
		owner = {
			add_resource = {
				energy = -1000
			}
		}
	}
}

# Demetrius Cornucopia -> id 700

#On Demetrius Cornucopia built
planet_event = {
	id = pw_wonder.700
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_demetrius_fields_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.701 }
		planet_event = { id = pw_wonder.702 }
	}
}

#On first time Demetrius Cornucopia is built (Regular Empire)
planet_event = {
	id = pw_wonder.701
	title = pw_wonder.701.name
	desc = pw_wonder.701.desc
	picture = GFX_evt_domed_city
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.701.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = demetrius_fields_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = demetrius_fields_built }
	}
}

#On first time Demetrius Cornucopia is built (Gestalt)
planet_event = {
	id = pw_wonder.702
	title = pw_wonder.702.name
	desc = pw_wonder.702.desc
	picture = GFX_evt_domed_city
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.702.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = demetrius_fields_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = demetrius_fields_built }
	}
}

#Random Predatory Harvesting effect
planet_event = {
	id = pw_wonder.703
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = { has_planet_flag = pw_predatory_harvesting_event_triggered }
	}

	immediate = {
		set_planet_flag = pw_predatory_harvesting_event_triggered
		if = {
			limit = { #Hive planets can't have Natural Beauty mod.
				OR = {
					is_planet_class = pc_hive
				}
			}
			random_list = {
				10 = {
					planet_event = {
						id = pw_wonder.704
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.705
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.706
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.707
						days = 60
						random = 30
					}
				}
				5 = {}
			}
		}
		else = {
			random_list = {
				10 = {
					planet_event = {
						id = pw_wonder.704
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.705
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.706
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.707
						days = 60
						random = 30
					}
				}
				10 = {
					planet_event = {
						id = pw_wonder.708
						days = 60
						random = 30
					}
				}
				5 = {}
			}
		}
	}
}

#Predatory Harvesting adds Lush
planet_event = {
	id = pw_wonder.704
	title = pw_wonder.704.name
	desc = pw_wonder.704.desc
	picture = GFX_evt_domed_city
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_lush }
		has_building = pw_building_demetrius_fields
	}
	option = {
		name = pw_wonder.704.a
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = food
					value >= 3000
				}
			}
		}
		add_modifier = {
			modifier = lush_planet
		}
		owner = {
			add_resource = {
				food = -3000
			}
		}
	}
	option = {
		name = pw_wonder.704.b
	}
}

#Predatory Harvesting adds Bleak
planet_event = {
	id = pw_wonder.705
	title = pw_wonder.705.name
	desc = pw_wonder.705.desc
	picture = GFX_evt_domed_city
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_bleak }
		has_building = pw_building_demetrius_fields
	}
	option = {
		name = pw_wonder.705.a
		add_modifier = {
			modifier = bleak_planet
		}
	}
	option = {
		name = pw_wonder.705.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = food
					value >= 2000
				}
			}
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 1000
				}
			}
		}
		owner = {
			add_resource = {
				food = -2000
				energy = -1000
			}
		}
	}
}

#Predatory Harvesting adds Hostile Fauna
planet_event = {
	id = pw_wonder.706
	title = pw_wonder.706.name
	desc = pw_wonder.706.desc
	picture = GFX_evt_domed_city
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_dangerous_wildlife }
		has_building = pw_building_demetrius_fields
	}
	option = {
		name = pw_wonder.706.a
		add_modifier = {
			modifier = dangerous_wildlife
		}
	}
	option = {
		name = pw_wonder.706.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value >= 1000
				}
			}
		}
		owner = {
			add_resource = {
				energy = -1000
			}
		}
	}
}

#Predatory Harvesting adds Titanic Life
planet_event = {
	id = pw_wonder.707
	title = pw_wonder.707.name
	desc = pw_wonder.707.desc
	picture = GFX_evt_domed_city
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_titanic_life }
		has_building = pw_building_demetrius_fields
	}
	option = {
		name = pw_wonder.707.a
		add_modifier = {
			modifier = titanic_life
		}
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = food
					value >= 1000
				}
			}
		}
		owner = {
			add_resource = {
				food = -1000
			}
		}
	}
	option = {
		name = pw_wonder.707.b
	}
}

#Predatory Harvesting adds Natural Beauty
planet_event = {
	id = pw_wonder.708
	title = pw_wonder.708.name
	desc = pw_wonder.708.desc
	picture = GFX_evt_domed_city
	show_sound = event_alien_nature
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_planet_modifier = pm_natural_beauty }
		has_building = pw_building_demetrius_fields
	}
	option = {
		name = pw_wonder.708.a
		add_modifier = {
			modifier = natural_beauty
		}
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = food
					value >= 2000
				}
			}
		}
		owner = {
			add_resource = {
				food = -2000
			}
		}
	}
	option = {
		name = pw_wonder.708.b
	}
}

# Astronomical Model Bureau -> id 800

#On Astronomical Model Bureau built
planet_event = {
	id = pw_wonder.800
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_galactic_model_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.801 }
		planet_event = { id = pw_wonder.802 }
		planet_event = { id = pw_wonder.803 days = 60 random = 30}
	}
}

#On first time Astronomical Model Bureau is built (Regular Empire)
planet_event = {
	id = pw_wonder.801
	title = pw_wonder.801.name
	desc = pw_wonder.801.desc
	picture = GFX_evt_galactic_model
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.801.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.801.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
		trigger = {
			owner = { is_spiritualist = yes }
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = galactic_model_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = galactic_model_built }
	}
}

#On first time Astronomical Model Bureau is built (Gestalt)
planet_event = {
	id = pw_wonder.802
	title = pw_wonder.802.name
	desc = pw_wonder.802.desc
	picture = GFX_evt_galactic_model
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.802.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.802.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_unity
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = galactic_model_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = galactic_model_built }
	}
}

#Tow asteroid
planet_event = {
	id = pw_wonder.803
	title = pw_wonder.803.name
	desc = pw_wonder.803.desc
	picture = GFX_evt_galactic_model
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_galactic_model
		NOT = { owner = { has_country_flag = galactic_model_tow_asteroid }}
		owner = {
			any_planet_within_border = {
				is_planet_class = pc_asteroid
			}
		}
	}

	immediate = {
		owner = { set_country_flag = galactic_model_tow_asteroid }
	}

	option = {
		name = pw_wonder.803.a
		owner = {
			random_planet_within_border = {
				limit = {
					is_planet_class = pc_asteroid
				}
				enable_special_project = {
					name = PW_TOW_ASTEROID_PROJECT
					location = this
					owner = root
				}
			}
		}
	}

	option = {
		name = pw_wonder.803.b
		allow = {
			has_resource = { type = influence amount > 100 }
		}
		owner = {
			add_resource = {
				influence = -100
			}
		}
	}
}

planet_event = {
	id = pw_wonder.804
	title = pw_wonder.804.name
	desc = pw_wonder.804.desc
	picture = GFX_evt_galactic_model
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.804.a
		owner = {
			add_resource = {
				unity = 1000
				engineering_research = 1000
			}
		}
	}
}

# Panopticon -> id 900

#On Panopticon built
planet_event = {
	id = pw_wonder.900
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_panopticon_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.901 }
		owner = { country_event = { id = pw_wonder.902 }}
	}
}

#On first time Panopticon is built (Regular Empire)
planet_event = {
	id = pw_wonder.901
	title = pw_wonder.901.name
	desc = pw_wonder.901.desc
	picture = GFX_evt_announcement
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.901.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.901.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = panopticon_built }}
	}

	immediate = {
		owner = { set_country_flag = panopticon_built }
	}
}

#Get another empire with corrupt leader
country_event = {
	id = pw_wonder.902
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_at_war = no
		is_ai = no
		any_owned_planet = {
			has_building = pw_building_panopticon
		}
		any_country = {
			any_neighbor_country = {
				is_ai = yes
				is_country_type = default
				is_gestalt = no
				is_homicidal = no
				has_communications = root
				NOT = { is_at_war_with = root }
				NOT = { has_valid_civic = civic_criminal_heritage }
				any_owned_leader = {
					has_trait = leader_trait_corrupt
				}
			}
		}
	}

	immediate = {
		random_neighbor_country = {
			limit = {
				is_ai = yes
				is_country_type = default
				is_gestalt = no
				is_homicidal = no
				has_communications = root
				NOT = { is_at_war_with = root }
				NOT = { has_valid_civic = civic_criminal_heritage }
				any_owned_leader = {
					has_trait = leader_trait_corrupt
				}
			}
			save_event_target_as = PWEmpireWithCorruptLeader
			random_owned_leader = {
				limit = {
					has_trait = leader_trait_corrupt
				}
				save_event_target_as = PWForeignCorruptLeader
			}
			root = { country_event = { id = pw_wonder.903 } }
		}
	}
}

#Empire with corrupt leader asks to deal with it.
country_event = {
	id = pw_wonder.903
	title = pw_wonder.903.name
	desc = pw_wonder.903.desc
	show_sound = diplomatic_notification
	is_triggered_only = yes
	location = THIS
	diplomatic = yes

	trigger = {
		any_owned_planet = {
			has_building = pw_building_panopticon
		}
	}
	picture_event_data = {
		portrait = event_target:PWEmpireWithCorruptLeader
		planet_background = event_target:PWEmpireWithCorruptLeader
		graphical_culture = event_target:PWEmpireWithCorruptLeader
		city_level = event_target:PWEmpireWithCorruptLeader
		room = event_target:PWEmpireWithCorruptLeader.ruler
	}
	option = {
		name = pw_wonder.903.a
		add_favors = {
			target = event_target:PWEmpireWithCorruptLeader
			value = 2
		}
		event_target:PWEmpireWithCorruptLeader = {
			add_opinion_modifier = {
				who = root
				modifier = pw_opinion_helped_with_corruption
			}
		}
		event_target:PWForeignCorruptLeader = {
			remove_trait = leader_trait_corrupt
		}
	}
	option = {
		name = pw_wonder.903.b
		add_resource = {
			energy = 1000
		}
		event_target:PWEmpireWithCorruptLeader = {
			add_opinion_modifier = {
				who = root
				modifier = pw_opinion_helped_with_corruption
			}
		}
		event_target:PWForeignCorruptLeader = {
			kill_leader = {}
		}
	}
	option = {
		name = pw_wonder.903.c
		add_resource = {
			influence = 50
		}
		event_target:PWEmpireWithCorruptLeader = {
			add_opinion_modifier = {
				who = root
				modifier = pw_opinion_refused_to_help
			}
		}
	}

}

#Examine crime in other empires

# Enigma Engine -> id 1000

#On Enigma Engine built
planet_event = {
	id = pw_wonder.1000
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_enigma_engine_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.1001 }
		planet_event = { id = pw_wonder.1010 }
	}
}

#On first time Enigma Engine is built (Machine Empire)
planet_event = {
	id = pw_wonder.1001
	title = pw_wonder.1001.name
	desc = pw_wonder.1001.desc
	picture = GFX_evt_enigma_engine
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.1001.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	option = {
		name = pw_wonder.1001.b
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = enigma_engine_built }}
	}

	immediate = {
		owner = { set_country_flag = enigma_engine_built }
	}
}

# If last tech researched was Metaphysical Singularity and minor artifacts are needed
country_event = {
	id = pw_wonder.1002
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_ancrel = yes
		last_increased_tech = pw_tech_metaphysical_singularity
		resource_stockpile_compare = {
			resource = minor_artifacts
			value <= 10
		}
	}

	immediate = {
		country_event = {
			id = pw_wonder.1003
			days = 30
			random = 30
		}
	}
}

# Get some minor artifacts to build the Enigma Engine.
country_event = {
	id = pw_wonder.1003
	title = pw_wonder.1003.name
	desc = pw_wonder.1003.desc
	picture = GFX_evt_analyzing_artifacts
	show_sound = event_laboratory_sound
	is_triggered_only = yes

	trigger = {
		has_ancrel = yes
		has_technology = pw_tech_metaphysical_singularity
	}

	option = {
		name = pw_wonder.1003.a
		add_resource = {
			minor_artifacts = 15
		}
	}
}

#If last increased tech was a Enigma tech:
country_event = {
	id = pw_wonder.1004
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		pw_last_increased_tech_was_enigma_tech = yes
		NOT = { has_country_flag = pw_enigma_fe_task_started }
	}

	immediate = {
		set_country_flag = pw_enigma_fe_task_started
		# Get Fallen Empire to make request:
		country_event = { id = pw_wonder.1005 }
	}
}

#Get Machine Fallen empire to receive gift from
country_event = {
	id = pw_wonder.1005
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_at_war = no
		is_ai = no
		any_owned_planet = {
			has_building = pw_building_enigma_engine
		}
		any_country = {
			is_valid_fallen_empire_for_task = yes
			has_authority = auth_machine_intelligence
			has_communications = root
			opinion = {
				who = THIS
				value > -70
			}
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_valid_fallen_empire_for_task = yes
				has_authority = auth_machine_intelligence
				has_communications = root
				opinion = {
					who = THIS
					value > -70
				}
			}
			save_event_target_as = PWFallenEmpireTaskOrigin
			root = { country_event = { id = pw_wonder.1006 days = 30 random = 30} }
		}
	}
}

# Get Request from Fallen Empire after researching enigma tech
country_event = {
	id = pw_wonder.1006
	title = pw_wonder.1006.name
	desc = pw_wonder.1006.desc
	is_triggered_only = yes
	location = THIS
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireTaskOrigin
		planet_background = event_target:PWFallenEmpireTaskOrigin
		graphical_culture = event_target:PWFallenEmpireTaskOrigin
		city_level = event_target:PWFallenEmpireTaskOrigin
		room = event_target:PWFallenEmpireTaskOrigin.ruler
	}
	option = {
		name = pw_wonder.1006.a
		hidden_effect = {
			event_target:PWFallenEmpireGiftOrigin = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}
			country_event = { id = pw_wonder.1007 days = 60 random = 30	}
		}
	}
	option = {
		name = pw_wonder.1006.b
		hidden_effect = {
			event_target:PWFallenEmpireGiftOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}
		}
	}
}

# Get gift from Fallen Empire After fulfilling request.
country_event = {
	id = pw_wonder.1007
	title = pw_wonder.1007.name
	desc = pw_wonder.1007.desc
	is_triggered_only = yes
	location = THIS
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireTaskOrigin
		planet_background = event_target:PWFallenEmpireTaskOrigin
		graphical_culture = event_target:PWFallenEmpireTaskOrigin
		city_level = event_target:PWFallenEmpireTaskOrigin
		room = event_target:PWFallenEmpireTaskOrigin.ruler
	}

	option = {
		name = pw_wonder.1007.a
		if = {
			limit = { has_distar = yes }
			add_resource = {
				nanites = 250
				sr_living_metal = 250
			}
		}
		else = {
			add_resource = {
				sr_living_metal = 250
			}
		}
	}
	option = {
		name = pw_wonder.1007.b
		add_resource = {
			society_research = 5000
			physics_research = 5000
			engineering_research = 5000
		}
	}
	option = {
		name = pw_wonder.1007.c
		add_resource = {
			influence = 100
		}
	}
}

#Start Enigma Engine Energy
planet_event = {
	id = pw_wonder.1010
	title = pw_wonder.1010.name
	desc = pw_wonder.1010.desc
	picture = GFX_evt_enigma_engine
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_enigma_engine
		owner = { NOT = { has_country_flag = pw_enigma_engine_deviant_events }}
	}
	immediate = {
		owner = { set_country_flag = pw_enigma_engine_deviant_events }
	}
	option = {
		name = pw_wonder.1010.a
		add_modifier = {
			modifier = pw_mod_enigma_engine_energy
			days = -1
		}
		hidden_effect = {
			planet_event = { id = pw_wonder.1011 days = 180 random = 30 }
		}
	}
}

#Enigma Engine Housing
planet_event = {
	id = pw_wonder.1011
	title = pw_wonder.1011.name
	desc = pw_wonder.1011.desc
	picture = GFX_evt_enigma_engine
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_enigma_engine
	}
	option = {
		name = pw_wonder.1011.a
		add_modifier = {
			modifier = pw_mod_enigma_engine_housing
			days = -1
		}
		hidden_effect = {
			planet_event = { id = pw_wonder.1012 days = 180 random = 30 }
		}
	}
}

#Enigma Engine Art
planet_event = {
	id = pw_wonder.1012
	title = pw_wonder.1012.name
	desc = pw_wonder.1012.desc
	picture = GFX_evt_enigma_engine
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_enigma_engine
	}
	option = {
		name = pw_wonder.1012.a
		add_modifier = {
			modifier = pw_mod_enigma_engine_art
			days = -1
		}
		enable_special_project = {
			name = PW_FIX_ENIGMA_DRONES
			location = this
			owner = owner
		}
	}
	option = {
		name = pw_wonder.1012.b
		add_modifier = {
			modifier = pw_mod_enigma_engine_art
			days = -1
		}
		owner = { add_100_unity_per_year_passed = yes }
	}
}

planet_event = {
	id = pw_wonder.1013
	title = pw_wonder.1013.name
	desc = pw_wonder.1013.desc
	picture = GFX_evt_enigma_engine
	show_sound = event_cityscape
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.1013.a
		remove_modifier = pw_mod_enigma_engine_energy
		remove_modifier = pw_mod_enigma_engine_housing
		remove_modifier = pw_mod_enigma_engine_art
		owner = {
			add_resource = {
				influence = 50
			}
		}
	}
}

# Solipsist Debate Hall -> id 1100

#On Solipsist Debate Hall built
planet_event = {
	id = pw_wonder.1100
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_solipsist_debate_hall_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.1101 }
		owner = {
			country_event = {
				id = pw_solipsist_debate.1
			}
		}
	}
}

#On first time Solipsist Debate Hall is built (Hive Empire)
planet_event = {
	id = pw_wonder.1101
	title = pw_wonder.1101.name
	desc = pw_wonder.1101.desc
	picture = GFX_evt_hive_mind
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.1101.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = solipsist_debate_hall_built }}
	}

	immediate = {
		owner = { set_country_flag = solipsist_debate_hall_built }
	}
}

# If last tech researched was Metacognition Dialectics and minor artifacts are needed.
country_event = {
	id = pw_wonder.1102
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_ancrel = yes
		last_increased_tech = pw_tech_metacognition_dialectics
		resource_stockpile_compare = {
			resource = minor_artifacts
			value <= 10
		}
	}

	immediate = {
		country_event = {
			id = pw_wonder.1103
			days = 30
			random = 30
		}
	}
}

# Get some minor artifacts to build the Solipsist Debate Hall.
country_event = {
	id = pw_wonder.1103
	title = pw_wonder.1103.name
	desc = pw_wonder.1103.desc
	picture = GFX_evt_analyzing_artifacts
	show_sound = event_laboratory_sound
	is_triggered_only = yes

	trigger = {
		has_ancrel = yes
		has_technology = pw_tech_metacognition_dialectics
	}

	option = {
		name = pw_wonder.1103.a
		add_resource = {
			minor_artifacts = 15
		}
	}
}

#Get fallen empire to receive gift from
country_event = {
	id = pw_wonder.1104
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		NOT ={ has_country_flag = pw_sdh_fe_gift_received }
		is_at_war = no
		is_ai = no
		any_owned_planet = {
			has_building = pw_building_solipsist_debate_hall
		}
		any_country = {
			is_valid_fallen_empire_for_task = yes
			NOT = { has_authority = auth_machine_intelligence }
			has_communications = root
			opinion = {
				who = THIS
				value > -70
			}
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_valid_fallen_empire_for_task = yes
				NOT = { has_authority = auth_machine_intelligence }
				has_communications = root
				opinion = {
					who = THIS
					value > -70
				}
			}
			save_event_target_as = PWFallenEmpireGiftOrigin
			root = { country_event = { id = pw_wonder.1105 } }
		}
	}
}

# Get gift from Fallen Empire After a Debate.
country_event = {
	id = pw_wonder.1105
	title = pw_wonder.1105.name
	desc = pw_wonder.1105.desc
	is_triggered_only = yes
	location = THIS
	show_sound = diplomatic_notification
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:PWFallenEmpireGiftOrigin
		planet_background = event_target:PWFallenEmpireGiftOrigin
		graphical_culture = event_target:PWFallenEmpireGiftOrigin
		city_level = event_target:PWFallenEmpireGiftOrigin
		room = event_target:PWFallenEmpireGiftOrigin.ruler
	}

	immediate = {
		set_country_flag = pw_sdh_fe_gift_received
	}
	option = {
		name = pw_wonder.1105.a
		add_resource = {
			sr_dark_matter = 250
		}
		hidden_effect = { event_target:PWFallenEmpireGiftOrigin = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}}
	}
	option = {
		name = pw_wonder.1105.b
		add_100_unity_per_year_passed = yes
		hidden_effect = { event_target:PWFallenEmpireGiftOrigin = { add_opinion_modifier = { who = root modifier = opinion_accepted_fallen_empire_request }}}
	}
	option = {
		name = pw_wonder.1105.c
		add_resource = {
			influence = 100
		}
		hidden_effect = { event_target:PWFallenEmpireGiftOrigin = { add_opinion_modifier = { who = root modifier = opinion_refused_fallen_empire_request }}}
	}
}

# Hive fights after a Debate.
country_event = {
	id = pw_wonder.1106
	title = pw_wonder.1106.name
	desc = pw_wonder.1106.desc
	picture = GFX_evt_hive_mind
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_country_flag = pw_sdh_debate_conflict }
	}

	immediate = {
		set_country_flag = pw_sdh_debate_conflict
	}
	option = {
		name = pw_wonder.1106.a
		add_modifier = {
			modifier = pw_debate_mod_syncretic
			days = @pw_1year
		}
	}
	option = {
		name = pw_wonder.1106.b
		add_modifier = {
			modifier = pw_debate_mod_deviancy
			days = @pw_1year
		}
	}
	option = {
		name = pw_wonder.1106.c
		random_owned_pop = { kill_pop = yes }
	}
}

# Guardian Angel -> id 1200

#On Guardian Angel built
planet_event = {
	id = pw_wonder.1200
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_occupied_flag = no
	}

	immediate = {
		create_message = {
			type = BUILDING_CONSTRUCTION_MESSAGE_TYPE
			localization = pw_message_guardian_angel_complete
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}

		planet_event = { id = pw_wonder.1201 } #Regular first time
		planet_event = { id = pw_wonder.1202 } #Gestalt first time
		planet_event = { id = pw_wonder.1203 } #Add flying fortress army
		planet_event = { id = pw_wonder.1207 days = 60 random = 30 } #Guardian Angel Peace Choice.
	}
}

#On first time Guardian Angel is built (Regular Empire)
planet_event = {
	id = pw_wonder.1201
	title = pw_wonder.1201.name
	desc = pw_wonder.1201.desc
	picture = GFX_evt_landing_ship_2
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.1201.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = guardian_angel_built }}
		owner = { is_gestalt = no }
	}

	immediate = {
		owner = { set_country_flag = guardian_angel_built }
	}
}

#On first time Guardian Angel is built (Gestalt Empire)
planet_event = {
	id = pw_wonder.1202
	title = pw_wonder.1202.name
	desc = pw_wonder.1202.desc
	picture = GFX_evt_landing_ship_2
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	option = {
		name = pw_wonder.1202.a
		if = {
			limit = {
				NOR = {
					has_modifier = pw_mod_wonder_built_recently_happiness
					has_modifier = pw_mod_wonder_built_recently_unity
				}
			}
			add_modifier = {
				modifier = pw_mod_wonder_built_recently_happiness
				days = @pw_5years
			}
		}
	}

	trigger = {
		NOT = {owner = { has_country_flag = guardian_angel_built }}
		owner = { is_gestalt = yes }
	}

	immediate = {
		owner = { set_country_flag = guardian_angel_built }
	}
}

#On Guardian Angel built add army
planet_event = {
	id = pw_wonder.1203
	hide_window = yes
	is_triggered_only = yes
	location = THIS

	trigger = {
		has_building = pw_building_guardian_angel
		NOT = {
			any_planet_army = {
				army_type = pw_army_flying_fortress
			}
		}
	}

	immediate = {
		create_army = {
			name = pw_army_flying_fortress_name
			owner = THIS.owner
			type = pw_army_flying_fortress
		}
	}

}

#On Guardian Angel destroyed/replaced ->
planet_event = {
	id = pw_wonder.1204
	hide_window = yes
	is_triggered_only = yes
	location = THIS

	trigger = {
		last_building_changed = pw_building_guardian_angel
	}

	immediate = {
		planet_event = {
			id = pw_wonder.1205
		}
	}
}

# -> remove Flying Fortress
planet_event = {
	id = pw_wonder.1205
	hide_window = yes
	is_triggered_only = yes
	location = THIS

	trigger = {
		NOT = { has_building = pw_building_guardian_angel }
		any_planet_army = {
			army_type = pw_army_flying_fortress
		}
	}

	immediate = {
		every_planet_army = {
			limit = { army_type = pw_army_flying_fortress }
			remove_army = yes
		}
	}
}

#On Flying Fortress is rebuild
planet_event = {
	id = pw_wonder.1206
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
	}

	immediate = {
		create_message = {
			type = ARMY_RECRUITMENT
			localization = pw_message_guardian_angel_flying_fortress_rebuild
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = ROOT
			}
		}
	}
}

planet_event = {
	id = pw_wonder.1207
	title = pw_wonder.1207.name
	desc = pw_wonder.1207.desc
	picture = GFX_evt_landing_ship_2
	show_sound = event_construction
	is_triggered_only = yes
	location = THIS

	trigger = {
		owner = { is_at_war = no }
		NOR = {
			has_planet_flag = pw_guardian_angel_train
			has_planet_flag = pw_guardian_angel_police_operations
			has_planet_flag = pw_guardian_angel_attraction
		}
	}
	option = {
		name = pw_wonder.1207.a
		custom_tooltip = pw_wonder.1207.a.tooltip
		hidden_effect = {
			set_planet_flag = pw_guardian_angel_train
		}
	}
	option = {
		name = pw_wonder.1207.b
		custom_tooltip = pw_wonder.1207.b.tooltip
		hidden_effect = {
			set_planet_flag = pw_guardian_angel_police_operations
		}
	}
	option = {
		name = pw_wonder.1207.c
		custom_tooltip = pw_wonder.1207.c.tooltip
		trigger = {
			owner = { can_generate_trade_value = yes }
		}
		hidden_effect = {
			set_planet_flag = pw_guardian_angel_attraction
		}
	}
}
